---
title: "Homelessness in the UK: An In-depth Analysis"
author: "Ishita Khanna"
format: 
  html:
    fig-width: 8
    fig-height: 4
    code-fold: true
---

Link to the Shiny app: [ShinyApp](https://ishitakhanna.shinyapps.io/Walsall_Council/)

# Introduction

Homelessness is a pressing issue in the UK, encompassing a range of situations from rough sleeping to living in temporary accommodations. Over the years, the number of people experiencing homelessness has seen fluctuations, influenced by various economic, social, and political factors.

- **Rough Sleeping:** This is the most visible form of homelessness, referring to people who sleep on the streets, in doorways, parks, or other places not meant for habitation.
- **Temporary Accommodation:** This includes individuals or families living in hostels, B&Bs, or other short-term housing solutions provided by local councils or charities.
- **Hidden Homelessness:** Refers to people who donâ€™t have a place of their own and stay with friends or family, often moving from one place to another.

**Causes:**

- **Economic Factors:** Unemployment, poverty, and lack of affordable housing are significant contributors.
- **Social Factors:** Relationship breakdowns, domestic abuse, and health issues, especially mental health, can lead to homelessness.
- **Systemic Issues:** Gaps in social security benefits, lack of social housing, and other systemic challenges play a role.

**Efforts to Address the Issue:**

Various charities, NGOs, and local councils work tirelessly to provide shelter, food, and support to those affected. Government initiatives aim to reduce and prevent homelessness, but challenges remain. Understanding the trends and patterns of homelessness is crucial for policymakers, social workers, and charities to make informed decisions and bring about positive change.

\newpage

# Data Preparation and Analysis Setup

In this report, we analyze data related to homelessness decisions in UK from 2009 to 2018 and local authority homelessness decisions in 2023 based on various factors and also give some information on prediction of homelessness. The analysis is based on datasets from reputable sources including local authority reports and property price data.

**What is homelessness decisions?**

 - The homelessness decisions refers to the number of individual or number of households that are Homeless in a particular local authority or traditional areas.

::: {.cell .r .hidden-code}
```{r}
#| message: false
#| warning: false

# Load required libraries
library(ggplot2)
library(dplyr)
library(tidyr)
library(readxl)
library(plotly)
library(stats)
library(gridExtra)
library(reshape2)

# Load and process the trend dataset
data <- read_excel("PE1_2009-2018.xlsx")

data[grep("^20", names(data))] <- lapply(data[grep("^20", names(data))], as.character)

melted_data <- data %>%
  pivot_longer(cols = starts_with("20"), names_to = "Year", values_to = "Homelessness Decisions") %>%
  mutate(
    Year = as.numeric(substr(Year, 1, 4)),
    `Homelessness Decisions` = as.numeric(`Homelessness Decisions`)
  ) %>%
  replace_na(list(`Homelessness Decisions` = NA))
  
total_homelessness_by_year <- aggregate(`Homelessness Decisions` ~ Year, data=melted_data, FUN=sum)
  
# Load and process the geographical dataset
la_total <- read_excel("detailed_LA_23_total.xlsx", sheet = 1)
traditional_regions <- c("North East", "North West", "Yorkshire and the Humber", "East Midlands", 
                         "West Midlands", "East of England", "London", "South East", "South West")
la_total_geo <- la_total[la_total$Area %in% traditional_regions, ]
la_total_geo$Initial_assessment <- as.numeric(la_total_geo$Initial_assessment)
la_total_geo$Prevention_duty <- as.numeric(la_total_geo$Prevention_duty)
la_total_geo$Relief_duty <- as.numeric(la_total_geo$Relief_duty)

# Load and process data for Support Need Analysis
la_support <- read_excel("detailed_LA_23_total.xlsx", sheet = 2)
geo_regions_support_needs <- la_support[la_support$Area %in% traditional_regions, ]
geo_regions_support_needs$household_no_support <- as.numeric(geo_regions_support_needs$household_no_support)
geo_regions_support_needs$household_unknown_support <- as.numeric(geo_regions_support_needs$household_unknown_support)

# Load and process data for Age_group Analysis
la_age <- read_excel("detailed_LA_23_total.xlsx", sheet = 3)
age_groups <- c("16-17", "18-24", "25-34", "35-44", "45-54", "55-64", "65-74", "75plus")
for (col in age_groups) {
  la_age[[col]] <- as.numeric(la_age[[col]])
}
geo_regions_age_duty <- la_age[la_age$Area %in% traditional_regions, ]

# Load and process data for referral_group Analysis
la_referral <- read_excel("detailed_LA_23_total.xlsx", sheet = 4)
referral_groups <- c("Adult_secure_estate(prison)", "Youth_secure_estate", "National_probation_service", "Community_rehabilition_company", "Ugent_treatment_centres", "Mental_health", "Jobcentre_plus", "Adult_social_services", "Children_social_services", "Children_early_help", "Nil_resource_team", "State_of_defence", "Unknown", "household_referred_by_agency", "Household_referred_by_local_authority")
for (col in referral_groups) {
  la_referral[[col]] <- as.numeric(la_referral[[col]])
}
geo_regions_referral_duty <- la_referral[la_referral$Area %in% traditional_regions, ]

get_referral_description <- c("Adult_secure_estate(prison)" = "This indicates which regions have more referrals from prisons, potentially highlighting the need for better reintegration programs.",
         "Youth_secure_estate" = "This indicates which regions have more referrals from youth secure estates.",
         "National_probation_service" = "Regions with higher numbers here may require more focused services for individuals on probation.",
         "Community_rehabilition_company" = "This indicates regions with referrals from community rehabilitation companies.",
         "Ugent_treatment_centres" = "Referrals from urgent treatment centers indicate regions where immediate medical attention was sought.",
         "Mental_health" = "This can indicate the regions where mental health services may be most needed.",
         "Jobcentre_plus" = "This will show which regions have more referrals from employment services, potentially indicating a link between unemployment and homelessness.",
         "Adult_social_services" = "Regions with higher referrals from adult social services may indicate a need for more comprehensive social care programs.",
         "Children_social_services" = "Referrals from children's social services highlight regions with potential vulnerabilities among younger populations.",
         "Children_early_help" = "This indicates regions where early intervention services for children were sought.",
         "Nil_resource_team" = "Referrals from the Nil resource team can provide insights into specific cases without external resource involvement.",
         "State_of_defence" = "Regions with higher referrals from the state of defense may have populations involved in defense services.",
         "Unknown" = "For unknown referrals, the source of the referral wasn't clearly identified.",
         "household_referred_by_agency" = "Regions with more households referred by agencies can provide insights into the involvement of external organizations.",
         "Household_referred_by_local_authority" = "This shows regions where local authorities have been actively referring households."
  )

# Load and prepare data for ethnicity_group Analysis
la_ethnicity <- read_excel("detailed_LA_23_total.xlsx", sheet = 5)
ethnicity_groups <- c("British", "Irish", "Gypsy", "Other_white", "British_African", "British_Caribbean", "Other_black", "British_pakistani", "British_Indian", "British_Bangladeshi", "British_chinese", "Other_asian", "White_black_caribbean", "White_black_african", "White_asian", "Other_multiple_ethnic_background", "Arab", "Other_ethnic_groups", "Unknown")
for (col in ethnicity_groups) {
  la_ethnicity[[col]] <- as.numeric(la_ethnicity[[col]])
}
geo_regions_ethnicity_duty <- la_ethnicity[la_ethnicity$Area %in% traditional_regions, ]

# Load and prepare data for employment_group Analysis
la_employment <- read_excel("detailed_LA_23_total.xlsx", sheet = 6)
employment_groups <- c("Full_time", "Part_time", "Student", "Registered_unemployed", "Not_registered_but_seeking", "Not_seeking", "Not_working_due_to_illness", "Retired", "Other", "Unknown")
for (col in employment_groups) {
  la_employment[[col]] <- as.numeric(la_employment[[col]])
}
geo_regions_employment_duty <- la_employment[la_employment$Area %in% traditional_regions, ]

# Load and prepare the price paid dataset
house_sale <- read_excel("ppd_data_headers.xlsx")
relevant_columns <- c('unique_id', 'price_paid', 'deed_date', 'postcode', 'property_type', 'new_build', 'estate_type')
house_sale <- house_sale %>%
  select(all_of(relevant_columns))
house_sale <- na.omit(house_sale, cols = "postcode")

house_sale$year <- as.numeric(format(house_sale$deed_date, "%Y"))

avg_price_by_year <- aggregate(price_paid ~ year, data=house_sale, FUN=mean)
```
:::

\newpage

 *Homelessness is more than just a statistic; it's a pressing societal concern that demands our collective awareness and action. So, let's begin our exploration of this important topic by examining its different facets and the underlying causes.*

## Data visualisation of homelessness decisions of specific authority

 **Rationale for Selection of Local Authorities**

In this report, we have chosen to analyze trends and data from the local authorities of Walsall, Dudley, Sandwell, and Wolverhampton within the West Midlands county. The decision to focus on these specific local authorities is underpinned by the following considerations:

**1. Stakeholder Request:** The project was initiated in collaboration with the Walsall Council, which expressed a particular interest in these four local authorities. Their request was driven by the unique administrative and geographical association of these councils within the Black Country region of the West Midlands.

**2. Geographical and Administrative Cohesion:** These local authorities, being part of the Black Country, exhibit a significant degree of geographical and administrative cohesion. They share common urban characteristics and face similar challenges, making them an ideal group for comparative analysis.

**3. Interconnected Trends:** Exploring trends within Walsall, Dudley, Sandwell, and Wolverhampton allows us to understand how urban policies and developments manifest in a region that is closely interconnected. By comparing and contrasting these local authorities, we can identify similarities and differences that hold valuable insights for local governance.

**4. Stakeholder Alignment:** Focusing on these specific authorities aligns with the objectives and interests of the Walsall Council, which seeks to gain a deeper understanding of regional trends and policy impacts within the Black Country. The chosen approach reflects our commitment to delivering results that directly address the organization's needs and concerns.

```{r}
plot_specific_authority <- function(authority, data) {
  authority_data <- data %>% filter(`Local authority area` == authority)
  
  plot <- ggplot(authority_data, aes(x = Year, y = `Homelessness Decisions`)) +
    geom_line() + 
    geom_point() +
    ggtitle(paste("Homelessness Decisions in", authority)) +
    xlab("Year") +
    ylab("Number of Homelessness Decisions") +
    theme_minimal()
  
  return(plot)
}

# Plots for specific local authorities (replace 'melted_data' with your data frame name)
plot_specific_authority("Walsall", melted_data)
```

 **Walsall**
 
 - We observe an initial sharp decline in homelessness in Walsall. This could be attributed to rapid improvements in conditions, such as the implementation of effective housing policies, increased job opportunities, or more robust social welfare programs. Following this, we witness a relatively stable period with minor fluctuations, suggesting steady conditions. However, in recent times, we notice a gradual increase, possibly due to worsening economic conditions, rising housing costs, or a decrease in the effectiveness of social programs.

```{r}
plot_specific_authority("Dudley", melted_data)
```

 **Dudley**
 
 - Dudley presents a unique trend with an initial decrease in homelessness, followed by remarkable stability. It's important to note that the initial decrease may be misleading, as it may be due to underreporting rather than actual improvement in conditions. After the increase, we see a return to the baseline, indicating a level of stability in homelessness, with the exception of the unrecorded period.

```{r}
plot_specific_authority("Sandwell", melted_data)
```

 **Sandwell**
 
 - In Sandwell, an initial decline in homelessness suggests that policies or economic conditions were improving, leading to a reduction in homelessness. However, there's a sharp increase in homelessness, indicating a potential economic crisis, policy changes, or a surge in housing costs.

```{r}
plot_specific_authority("Wolverhampton", melted_data)
```

 **Wolverhampton**
 
 - Wolverhampton shows a trend of initial decrease in homelessness, reflecting improving conditions for vulnerable populations. Toward the end of the period, there's a slight increase in homelessness, hinting at potential deterioration in conditions.

\newpage

 In our report, we have chosen to focus on the traditional regions of "North East," "North West," "Yorkshire and the Humber," "East Midlands," "West Midlands," "East of England," "London," "South East," and "South West." These regions were selected based on their geographic diversity, population density, economic significance, cultural and social diversity, accessibility to data, historical and policy relevance, and stakeholder interests. This selection allows us to provide a well-rounded analysis that aligns with the objectives of our study.

## Initial Assessment by Area

```{r}
ggplot(la_total_geo, aes(x = Area, y = Initial_assessment)) +
  geom_bar(stat = "identity") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  ggtitle("Initial Assessment by Area")
```



## Prevention Duty by Area

```{r}
ggplot(la_total_geo, aes(x = Area, y = Prevention_duty)) +
  geom_bar(stat = "identity") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  ggtitle("Prevention Duty by Area")
```

## Relief Duty by Area

```{r}
ggplot(la_total_geo, aes(x = Area, y = Relief_duty)) +
  geom_bar(stat = "identity") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  ggtitle("Relief Duty by Area")
```

\newpage

## Supprt Need Analysis

```{r}
# Plot for Household with No Support Needs
plot_no_support <- ggplot(geo_regions_support_needs, aes(x = Area, y = household_no_support)) +
  geom_bar(stat = "identity", fill = "skyblue") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  ggtitle("Household with No Support Needs by Geographical Regions")

# Plot for Household with Unknown Support Needs
plot_unknown_support <- ggplot(geo_regions_support_needs, aes(x = Area, y = household_unknown_support)) +
  geom_bar(stat = "identity", fill = "salmon") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  ggtitle("Household with Unknown Support Needs by Geographical Regions")

# Arrange the plots side by side
grid.arrange(plot_no_support, plot_unknown_support, ncol = 2)
```

\newpage

## Homelessness Analysis by Age Group

```{r}
# Function to generate faceted plot for all age groups
plot_all_age_groups <- function(data, age_groups) {
  # Melt the data to long format for faceting
  data_long <- reshape2::melt(data, id.vars = "Area", measure.vars = age_groups)

  # Generate faceted plot
  ggplot(data_long, aes(x = Area, y = value)) +
    geom_bar(stat = "identity") +
    facet_wrap(~variable, scales = "free_y") +
    theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
    ggtitle("Homelessness by Age Groups in Geographical Regions")
}

data <- geo_regions_age_duty

# Generate the faceted plot
age_group_plot <- plot_all_age_groups(data, age_groups)

# Display the faceted plot
print(age_group_plot)
```

\newpage

## Homelessness Analysis by Referral Sources

<div class="referral-descriptions">
  <h2>Referral Source Descriptions</h2>
  <ul>
    <li><strong>Adult Secure Estate (Prison):</strong> Indicates which regions have more referrals from prisons, potentially highlighting the need for better reintegration programs.</li>
    <li><strong>Youth Secure Estate:</strong> Indicates which regions have more referrals from youth secure estates.</li>
    <li><strong>National Probation Service:</strong> Regions with higher numbers here may require more focused services for individuals on probation.</li>
    <li><strong>Community Rehabilitation Company:</strong> Indicates regions with referrals from community rehabilitation companies.</li>
    <li><strong>Urgent Treatment Centres:</strong> Referrals from urgent treatment centers indicate regions where immediate medical attention was sought.</li>
    <li><strong>Mental Health:</strong> Indicates the regions where mental health services may be most needed.</li>
    <li><strong>Jobcentre Plus:</strong> Shows which regions have more referrals from employment services, potentially indicating a link between unemployment and homelessness.</li>
    <li><strong>Adult Social Services:</strong> Regions with higher referrals from adult social services may indicate a need for more comprehensive social care programs.</li>
    <li><strong>Children Social Services:</strong> Referrals from children's social services highlight regions with potential vulnerabilities among younger populations.</li>
    <li><strong>Children Early Help:</strong> Indicates regions where early intervention services for children were sought.</li>
    <li><strong>Nil Resource Team:</strong> Referrals from the Nil resource team can provide insights into specific cases without external resource involvement.</li>
    <li><strong>State of Defence:</strong> Regions with higher referrals from the state of defense may have populations involved in defense services.</li>
    <li><strong>Unknown:</strong> For unknown referrals, the source of the referral wasn't clearly identified.</li>
    <li><strong>Household Referred by Agency:</strong> Regions with more households referred by agencies can provide insights into the involvement of external organizations.</li>
    <li><strong>Household Referred by Local Authority:</strong> Shows regions where local authorities have been actively referring households.</li>
  </ul>
</div>


```{r}
# Function to generate faceted plot for all referral sources
plot_all_referral_sources <- function(data, referral_groups) {
  # Melt the data to long format for faceting
  data_long <- melt(data, id.vars = "Area", measure.vars = referral_groups)


  # Generate faceted plot
  p <- ggplot(data_long, aes(x = Area, y = value)) +
    geom_bar(stat = "identity") +
    facet_wrap(~variable, scales = "free_y") +
    theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
    ggtitle("Homelessness Referrals by Sources in Traditional Regions")

  return(p)
}

data <- geo_regions_referral_duty

# Generate the faceted plot
referral_source_plot <- plot_all_referral_sources(data, referral_groups)

# Display the faceted plot
print(referral_source_plot)
```

\newpage

## Homelessness Analysis based on Ethnicity groups

```{r}
plot_all_ethnicities <- function(data, ethnicity_groups) {
  # Melt the data to long format for faceting
  data_long <- reshape2::melt(data, id.vars = "Area", measure.vars = ethnicity_groups)

  # Generate faceted plot
  ggplot(data_long, aes(x = Area, y = value)) +
    geom_bar(stat = "identity") +
    facet_wrap(~variable, scales = "free_y") +
    theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
    ggtitle("Homelessness Cases Identifying as Different Ethnicities in Geographical Regions")
}

data <- geo_regions_ethnicity_duty

# Generate the faceted plot
ethnicity_plot <- plot_all_ethnicities(data, ethnicity_groups)

# Display the faceted plot
print(ethnicity_plot)
```

\newpage

## Homelessness Analysis based on the Employment Groups

<div class="employment-descriptions">
  <h2>Employment Status Descriptions</h2>
  <ul>
    <li><strong>Full Time:</strong> High numbers here could indicate a need for affordable housing or living wage initiatives.</li>
    <li><strong>Part Time:</strong> High numbers might indicate employment instability as a factor in homelessness.</li>
    <li><strong>Student:</strong> High number might indicate students who are highly in debt because of their study fees and been homeless because they don't have any source of income.</li>
    <li><strong>Registered Unemployed:</strong> These regions potentially require job training or employment programs.</li>
    <li><strong>Not Registered but Seeking:</strong> High number indicates that there is so much difficulty in finding a job that people are homeless because of being unemployed even after getting good quality of education.</li>
    <li><strong>Not Seeking:</strong> The high count in this category possibly points to other factors like illness or disability as the main issue.</li>
    <li><strong>Not Working Due to Illness:</strong> High number gives us an idea as to where we need to invest more in terms of healthcare.</li>
    <li><strong>Retired:</strong> This will show which regions have homelessness cases among retirees.</li>
  </ul>
</div>


```{r}
# Function to generate faceted plot for all employment statuses
plot_all_employment_statuses <- function(data, employment_groups) {
  # Melt the data to long format for faceting
  data_long <- reshape2::melt(data, id.vars = "Area", measure.vars = employment_groups)

  # Generate faceted plot
  ggplot(data_long, aes(x = Area, y = value)) +
    geom_bar(stat = "identity") +
    facet_wrap(~variable, scales = "free_y") +
    theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
    ggtitle("Homelessness by Employment Status in Geographical Regions")
}

data <- geo_regions_employment_duty

# Generate the faceted plot
employment_status_plot <- plot_all_employment_statuses(data, employment_groups)

# Display the faceted plot
print(employment_status_plot)
```

## Top 5 local authority analysis

```{r}
# Create a plot for the top 5 local authorities
top_authorities_data <- melted_data %>% 
  filter(`Local authority area` %in% 
           (melted_data %>% 
              filter(`Local authority area` != 'ENGLAND') %>%
              group_by(`Local authority area`) %>%
              summarize(Average = mean(`Homelessness Decisions`, na.rm = TRUE)) %>%
              arrange(desc(Average)) %>%
              head(5) %>%  # Select the top 5
              pull(`Local authority area`)))

p <- ggplot(top_authorities_data, aes(x = Year, y = `Homelessness Decisions`, color = `Local authority area`)) +
  geom_line() +
  geom_point() +
  ggtitle("Top 5 Local Authorities by Average Number of Homelessness Decisions (Excluding England)") +
  xlab("Year") +
  ylab("Number of Homelessness Decisions") +
  theme_minimal() +
  theme(legend.position="bottom")

# Display the plot
print(p)
```

## Average homelessness trend

```{r mean-homelessness-plot, fig.cap="Mean Number of Homelessness Decisions per Year"}
# Plot the mean number of homelessness decisions per year across all local authorities
mean_data <- melted_data %>%
  group_by(Year) %>%
  summarize(Mean = mean(`Homelessness Decisions`, na.rm = TRUE))

p <- ggplot(mean_data, aes(x = Year, y = Mean)) +
  geom_line() +
  geom_point() +
  ggtitle("Mean Number of Homelessness Decisions per Year") +
  theme_minimal()

# Print the ggplot object
print(p)
```

## Price vs homelessness analysis

```{r price-vs-homelessness-plot, fig.cap="Average Property Price vs Total Homelessness by Year"}
# Join the two datasets
combined_data <- merge(avg_price_by_year, total_homelessness_by_year, by.x="year", by.y="Year")

# Create the plot
ggplot(combined_data) +
  geom_line(aes(x=year, y=price_paid, color="Average Property Price")) +
  geom_line(aes(x=year, y=`Homelessness Decisions`, color="Total Homelessness Decisions")) +
  geom_point(aes(x=year, y=price_paid)) +
  geom_point(aes(x=year, y=`Homelessness Decisions`)) +
  ggtitle("Average Property Price vs Total Homelessness by Year") +
  xlab("Year") +
  ylab("Value") +
  scale_y_continuous(sec.axis = sec_axis(~., name = "Total Homelessness Decisions")) +
  theme_minimal()
```

## Koopman Theory and Research

### Why Predict Homelessness?

- Predicting homelessness allows us to focus on prevention.
- Efficient resource allocation for social services and housing programs.
- Reduces economic burden on healthcare, emergency services, and the criminal justice system.
- Positions the UK as a global leader in social policy.
- Improves lives by ensuring opportunities for stable housing, health, education, and employment.

### Regression-based Analysis

- Given, at time step (year), we can represent homelessness decisions as a function of year and factors like 'Local Authority Regions' and 'Homelessness Decisions'.
- Regression often makes assumptions about data linearity, homoscedasticity, normality, and independence.
- Regression models might ignore the temporal nature of data.

### The Rise of Deep Learning

With advancements in computational capabilities and data abundance, neural networks have become state-of-the-art for prediction tasks, including time-series predictions using architectures like RNNs.

### Understanding the Koopman Theory

The discrete mapping between the target variable can be represented as:

$$
y_{t+1} = F(y_t)
$$

Where \( F(\cdot) \) is a non-linear function mapping which is usually unknown.

Lifting operation to represent in linear space using an observable function \( \phi(\cdot) \), which gives:

$$
z_t = \phi(y_t) \in \mathbb{R}^k
$$

Where \( k \) can be infinite dimensional long.

The mapping can be given using a linear operation:

$$
z_{t+1} = K z_t
$$

Where \( K \) is the Koopman Operator.

Finally, for predictions:

$$
\hat{y}_{t+1} = \phi^{-1}(K \phi(y_t))
$$
$$
\hat{y}_{t+2} = \phi^{-1}(K^2 \phi(y_t))
$$

And so on...

$$
\hat{y}_{t+T} = \phi^{-1}(K^T \phi(y_t))
$$

We can exploit the property of linearity to make multi-time step predictions.

### Neural Network Approach for Koopman

The Koopman Autoencoder (KAE) uses an Encoder and Decoder approach.

![Koopman Autoencoder](www/path_to_KAE_image_from_PDF.png)

### Training the Koopman Autoencoder

Training considers multiple loss functions, including reconstruction loss, linearity loss, and prediction loss.

### Applications of Koopman Autoencoder

![Use-cases of Koopman Autoencoder](www/path_to_SEA_image_from_PDF.png)